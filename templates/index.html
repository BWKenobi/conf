{% extends "base.html" %}
{% load static %}

{% block content %}
	{% if not user.is_authenticated %}
		<div class="text-center mt-3 pt-5">
			<h4>Всероссийская научно-практическая конференция</h4>
			<h1>"КУЛЬТУРА, ИСКУССТВО, ОБРАЗОВАНИЕ:</h1>
			<h1>ПОИСКИ И ОТКРЫТИЯ",</h1>
			<h4><em>посвященная Году Памяти и Славы</em></h4>
		</div>
		<div class="text-center mt-5 pb-5">
			<h4><a href="{% url 'register' %}" class="text-danger">Зарегистрироваться</a></h4>
		</div>
	{% else %}
		{% if not user.profile.admin_access %}
			<div class="text-center mt-3 pt-5">
				<h4>Всероссийская научно-практическая конференция</h4>
				<h1>"КУЛЬТУРА, ИСКУССТВО, ОБРАЗОВАНИЕ:</h1>
				<h1>ПОИСКИ И ОТКРЫТИЯ",</h1>
				<h4><em>посвященная Году Памяти и Славы</em></h4>
			</div>
			<div class="text-center mt-5 pb-5 text-danger">
				<h4>Здесь будет появляться вся актуальная информация<br>(дата и время коференции, ссылка-приглашение Zoom, сопроводительные документы).</h4>
			</div>
		{% else %}
			<div class="text-center mt-3 mb-5">
				<h4>Всероссийская научно-практическая конференция</h4>
				<h1>"КУЛЬТУРА, ИСКУССТВО, ОБРАЗОВАНИЕ:</h1>
				<h1>ПОИСКИ И ОТКРЫТИЯ",</h1>
				<h4><em>посвященная Году Памяти и Славы</em></h4>
			</div>
			<div class="text-left mt-3 px-5">
				<b>СПИСОК УЧАСТНИКОВ</b>
				<table class="table">
					<thead>
						<tr>
							<th scope="col" class="table-cel-width-5 align-middle">№</th>
							<th scope="col" class="table-cel-width-25 align-middle">Фамилия Имя Отчетво</th>
							<th scope="col" class="{% if user.profile.admin_access %}table-cel-width-45{% else %}table-cel-width-50{% endif %} align-middle">Место работы</th>
							<th scope="col" class="table-cel-width-20 align-middle">e-mail</th>
							{% if user.profile.admin_access %}
								<th scope="col" class="table-cel-width-5 align-middle">Админ.</th>
							{% endif %}
						</tr>
					</thead>
					<tbody>
						{% for usr in users %}
							<tr>
								<th scope="row" class="align-middle">{{ forloop.counter}}</th>
								<td class="align-middle">{{ usr.get_full_name }}</td>
								<td class="align-middle">{{ usr.work_place }}</td>
								<td class="align-middle">{{ usr.user.email }}</td>
								{% if user.profile.admin_access %}
									<td class="align-middle text-center">
										<input type="checkbox" id="{{usr.id }}" class="checking form-control" {% if usr.admin_access %} checked{% endif %} >
									</td>
								{% endif %}
							</tr>
						{% endfor %}
					</tbody>
				</table>
			</div>
		{% endif %}
	{% endif %}
{% endblock %}

{% block scripts %}
	{{ block.super }}
	<script type="text/javascript">
		$(document).ready(function() {
			$('.checking').change(function (){
				var user_id = $(this).attr('id');
				var access = $(this).prop('checked');

				$.ajax({
					url: "{% url 'change_access' %}",
					dataType: 'json',
					data: {
						'user_id': user_id,
						'access': access
					},
					success: function(data){
						alert ('Статус изменен.');
					}
				});
			});
		});
	</script>
{% endblock %}